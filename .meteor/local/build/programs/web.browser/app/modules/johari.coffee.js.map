)]}'
{"version":3,"file":"/modules/johari.coffee.js","sources":["johari.coffee"],"names":[],"mappings":"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","sourcesContent":["#Name: Johari test calculation\n#Author: Albert Kaigorodov\n#Desc: Machinery for johari testing, works with native Meteor.js users collection\n\n#  Structure:\n#  id: string,\n#  firstName: string,\n#  firstNameInt: string,\n#  gender: string\n#  results: {\n#    personal: {},\n#    friendsAnswers: [],\n#    friendsResults: {}\n#  }\n#  window: {\n#    open: {},\n#    blind: {},\n#    hidden: {},\n#    unknown: {}\n#  }\n\nif Meteor.isClient\n\n  @Johari = {\n\n\n    init: (user, results, callback)->\n\n      log 'Saving personal answers and creating johari object in user.profile.tests'\n      userId = user._id\n      Meteor.users.update userId, {$set: {'profile.tests.johari.id': userId}}\n      Meteor.users.update userId, {$set: {'profile.tests.johari.gender': user.profile.gender}}\n      Meteor.users.update userId, {$set: {'profile.tests.johari.firstName': user.profile.firstName}}\n      Meteor.users.update userId, {$set: {'profile.tests.johari.firstNameInt': user.profile.first_name}}\n      Meteor.users.update userId, {$set: {'profile.tests.johari.friendsPassed': 0}}\n      Meteor.users.update userId, {$set: {'profile.tests.johari.results.friendsAnswers': []}}\n      Meteor.users.update userId, {$set: {'profile.tests.johari.results.friendsResults': []}}\n      Meteor.users.update userId, {$set: {'profile.tests.johari.results.personal': results}}, ->\n        log 'johari initialized, results saved'\n      callback()\n\n    changePersonal: (userId, results)->\n\n      log 'Changing personal data...'\n      Meteor.users.update userId, {$set: {'profile.tests.johari.results.personal': results}}\n      @calcAndSave(userId)\n\n    add: (userId, results)->\n\n      log 'Saving friend answers and calling Johari::calc method'\n      Meteor.call 'johariSaveRawResults', userId, results, (err, res)=>\n        if err\n          log err\n        else\n          log 'Method johariSaveRawResults worked fine!'\n          @calcAndSave(userId)\n\n\n    calcAndSave: (id)->\n\n      personal = Meteor.users.findOne(id).profile.tests.johari.results.personal\n      friendsAnswers = Meteor.users.findOne(id).profile.tests.johari.results.friendsAnswers\n      log 'Calculating johari'\n      resultsBuffer = {}\n      openBuffer = {}\n      hiddenBuffer = {}\n      blindBuffer = {}\n      unknownBuffer = {}\n\n      log 'Personal:'\n      log personal\n\n      #Counting all friends results into resultsBuffer\n      log 'johari::counting friends results'\n      if friendsAnswers.length > 0\n        friendsAnswers.forEach (res)->\n          for answer of res\n            if resultsBuffer[answer]\n              resultsBuffer[answer] = resultsBuffer[answer] + res[answer]\n            else\n              resultsBuffer[answer] = res[answer]\n      log 'resultsBuffer:'\n      log resultsBuffer\n\n\n      #Counting open, hidden and unknown areas\n      log 'johari::counting open, hidden and unknown areas'\n      for answer of personal\n        if personal[answer] > 0\n          if resultsBuffer[answer] > 0\n            openBuffer[answer] = resultsBuffer[answer]\n          else\n            hiddenBuffer[answer] = personal[answer]\n        else\n          unknownBuffer[answer] = 0\n\n      log 'openBuffer:'\n      log openBuffer\n\n      log 'hiddenBuffer:'\n      log hiddenBuffer\n\n      log 'unknownBuffer:'\n      log unknownBuffer\n\n      #Counting blind area\n      log 'johari::counting blind area'\n      for answer of resultsBuffer\n        if resultsBuffer[answer] > 0 and personal[answer] is 0\n          blindBuffer[answer] = resultsBuffer[answer]\n\n      log 'blindBuffer:'\n      log blindBuffer\n\n      log 'Calling johariAsideSaveWindow method'\n\n      Meteor.call 'johariAsideSaveWindow', openBuffer, hiddenBuffer, blindBuffer, unknownBuffer, id, (err, res)->\n        if err\n          log err\n        else\n          log 'Johari data recalculated and saved with johariAsideSaveWidnow method'\n\n  }\n\n\nif Meteor.isServer\n\n  Meteor.methods {\n\n    johariAsideSaveWindow: (openBuffer, hiddenBuffer, blindBuffer, unknownBuffer, id)->\n\n      Meteor.users.update id, {$set: {'profile.tests.johari.window.open': openBuffer}}\n      Meteor.users.update id, {$set: {'profile.tests.johari.window.hidden': hiddenBuffer}}\n      Meteor.users.update id, {$set: {'profile.tests.johari.window.blind': blindBuffer}}\n      Meteor.users.update id, {$set: {'profile.tests.johari.window.unknown': unknownBuffer}}\n      console.log  Meteor.users.findOne(id).profile.tests.johari\n      true\n\n    johariSaveRawResults: (userId, results)->\n\n      Meteor.users.update userId, {$inc: {'profile.tests.johari.friendsPassed': 1}}\n      Meteor.users.update userId, {$push: {'profile.tests.johari.results.friendsAnswers': results}}\n      true\n\n  }"]}