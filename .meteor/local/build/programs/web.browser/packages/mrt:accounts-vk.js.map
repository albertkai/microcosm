)]}'
{"version":3,"file":"/packages/mrt:accounts-vk.js","sources":["mrt:accounts-vk/lib/accounts_vk.js","mrt:accounts-vk/lib/vk_client.js","mrt:accounts-vk/lib/vk_configure.html","mrt:accounts-vk/lib/vk_configure.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qC;;AAEA,sB;AACA,sD;AACA,6C;AACA,0D;AACA,+B;AACA,2B;AACA,S;;AAEA,0G;AACA,yE;AACA,M;AACA,Q;AACA,mC;AACA,yC;AACA,wB;AACA,6B;AACA,mC;AACA,gC;AACA,S;AACA,O;AACA,C;;;;;;;;;;;;;;;;;;;ACtBA,Q;;AAEA,8E;;AAEA,8E;AACA,oD;AACA,qB;AACA,K;;AAEA,8E;AACA,kB;AACA,+I;AACA,e;AACA,K;;AAEA,sC;AACA,wF;AACA,6C;AACA,mB;;AAEA,gD;AACA,qD;AACA,K;;AAEA,kB;AACA,0C;AACA,0C;AACA,mC;AACA,uG;AACA,mC;AACA,mC;AACA,wC;;AAEA,sF;AACA,E;;;;;;;;;;;;;;;;;;;ACjCA,qE;AACA,kB;AACA,oX;AACA,kB;AACA,4B;AACA,sD;AACA,kC;AACA,I;;;;;;;;;;;;;;;;;;;ACRA,iE;AACA,+B;AACA,8B;AACA,O;AACA,E;;AAEA,gE;AACA,Y;AACA,8C;AACA,iD;AACA,M;AACA,E","sourcesContent":["Accounts.oauth.registerService('vk');\n\nif (Meteor.isClient) {\n    Meteor.loginWithVk = function(options, callback) {\n        // support a callback without options\n        if (! callback && typeof options === \"function\") {\n            callback = options;\n            options = null;\n        }\n\n        var credentialRequestCompleteCallback = Accounts.oauth.credentialRequestCompleteHandler(callback);\n        VK.requestCredential(options, credentialRequestCompleteCallback);\n    };\n} else {\n    Accounts.addAutopublishFields({\n        forLoggedInUser: ['services.vk'],\n        forOtherUsers: [\n            'services.vk.id',\n            'services.vk.nickname',\n            'services.vk.gender'\n        ]\n    });\n}\n","VK = {};\n\nVK.requestCredential = function (options, credentialRequestCompleteCallback) {\n\n    if (!credentialRequestCompleteCallback && typeof options === 'function') {\n        credentialRequestCompleteCallback = options;\n        options = {};\n    }\n\n    var config = ServiceConfiguration.configurations.findOne({service: 'vk'});\n    if (!config) {\n        credentialRequestCompleteCallback && credentialRequestCompleteCallback(new ServiceConfiguration.ConfigError(\"Service not configured\"));\n        return;\n    }\n\n    var credentialToken = Random.id();\n    var mobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);\n    var display = mobile ? 'touch' : 'popup';\n    var scope = '';\n\n    if (options && options.requestPermissions) {\n        scope = options.requestPermissions.join(',');\n    }\n\n    var loginUrl =\n        'https://oauth.vk.com/authorize' +\n            '?client_id=' + config.appId +\n            '&scope='     + scope +\n            '&redirect_uri=' + Meteor.absoluteUrl('_oauth/vk?close=close', {replaceLocalhost: false}) +\n            '&response_type=code' +\n            '&display=' + display +\n            '&state=' + credentialToken;\n\n    Oauth.initiateLogin(credentialToken, loginUrl, credentialRequestCompleteCallback);\n};","\nTemplate.__define__(\"configureLoginServiceDialogForVk\", (function() {\n  var view = this;\n  return [ HTML.Raw(\"<p>\\n        First, you'll need to register your client on VKontakte. Follow these steps:\\n    </p>\\n    \"), HTML.OL(\"\\n        \", HTML.Raw('<li>\\n            Visit <a href=\"http://vk.com/editapp?act=create\" target=\"_blank\">http://vk.com/editapp?act=create</a>\\n        </li>'), \"\\n        \", HTML.LI(\"\\n            Set Callback URL to: \", HTML.SPAN({\n    \"class\": \"url\"\n  }, Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"siteUrl\"));\n  })), \"\\n        \"), \"\\n    \") ];\n}));\n","Template.configureLoginServiceDialogForVk.siteUrl = function () {\n    return Meteor.absoluteUrl({\n        replaceLocalhost: true\n    });\n};\n\nTemplate.configureLoginServiceDialogForVk.fields = function () {\n    return [\n        {property: 'appId',  label: 'App Id'},\n        {property: 'secret', label: 'App Secret'}\n    ];\n};"]}