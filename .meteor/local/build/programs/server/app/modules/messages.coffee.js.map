{"version":3,"file":"/modules/messages.coffee.js","sources":["messages.coffee"],"names":[],"mappings":";AAAA,IAAG,MAAM,CAAC,QAAV;AAGE,UAAQ,CAAC,OAAO,CAAC,OAAjB,CAAyB;IAEvB,UAAU,SAAC,EAAD;AACR,UAAG,OAAM,MAAM,CAAC,IAAP,EAAa,CAAC,GAAvB;eACE,QADF;;eAGE,GAHF;OADQ;KAFa;IAQvB,UAAU,SAAC,IAAD;aACR,OAAO,IAAP,CAAY,CAAC,IAAb,CAAkB,IAAlB,CAAuB,CAAC,QAAxB,GADQ;KARa;GAAzB;EAYA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B;IAExB,UAAU,SAAC,IAAD;aACR,OAAO,IAAP,CAAY,CAAC,IAAb,CAAkB,IAAlB,CAAuB,CAAC,QAAxB,GADQ;KAFc;IAKxB,aAAa,SAAC,OAAD,EAAU,IAAV;AAEX,UAAG,SAAQ,MAAX;eACE,QADF;aAEK,IAAG,SAAQ,OAAX;eACH,yEADG;OAJM;KALW;GAA1B,CAZA;EA0BA,QAAQ,CAAC,YAAY,CAAC,OAAtB,CAA8B;IAE5B,eAAe,SAAC,OAAD;AACb;eAAS,EAAT;MACA,KAAK,MAAM,CAAC,IAAP,EAAa,CAAC,GADnB;MAEA,OAAO,CAAC,OAAR,CAAgB,SAAC,CAAD;AACd,YAAG,OAAQ,CAAC,CAAC,EAAb;iBACE,UAAU,CAAC,CAAC,SAAF,GAAc,GAAd,GAAoB,CAAC,CAAC,QAAtB,GAAiC,KAD7C;SADc;OAAhB,CAFA;aAKA,MAAM,CAAC,SAAP,CAAiB,CAAjB,EAAoB,MAAM,CAAC,MAAP,GAAgB,CAApC,EANa;KAFa;GAA9B,CA1BA;EAsCA,QAAQ,CAAC,QAAQ,CAAC,QAAlB,GAA6B;AAE3B;mBAAe,EAAE,eAAF,CAAkB,CAAC,IAAnB,CAAwB,IAAxB,CAA6B,CAAC,KAA9B,EAAf;IACA,YAAY,CAAC,QAAb,CAAsB,SAAtB,CADA;IAEA,IAAI,CAAC,OAAL,CAAa;AACX;aAAO,MAAM,CAAC,KAAK,CAAC,OAAb,CAAqB;QAAC,oBAAoB,OAAO,CAAC,GAAR,CAAY,kBAAZ,CAArB;OAArB,CAAP;AACA,UAAG,IAAH;AACE,mBAAW,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,OAAQ,GAAE,CAAC,QAAjD;QACA,aAAa,OAAO,CAAC,OAAR,CAAgB;UAAC,KAAK,QAAN;SAAhB,CADb;QAEA,OAAO,CAAC,GAAR,CAAY,kBAAZ,EAAgC,MAAM,CAAC,IAAP,EAAa,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,OAAQ,GAAE,CAAC,QAA/E,CAFA;eAIA,EAAE,CAAC,MAAH,CAAU,EAAE,CAAC,cAAH,CAAkB,QAAQ,CAAC,YAA3B,EAAyC,UAAzC,CAAV,EAAgE,EAAE,kBAAF,CAAqB,CAAC,GAAtB,CAA0B,CAA1B,CAAhE,EALF;OAFW;KAAb,CAFA;WAWA,IAAI,CAAC,OAAL,CAAa;AAEX;UAAI,2BAAJ;MACA,eAAe,OAAO,CAAC,OAAR,CAAgB;QAAC,KAAK,OAAO,CAAC,GAAR,CAAY,kBAAZ,CAAN;OAAhB,CADf;AAEA,UAAG,YAAH;AACE,gBAAQ,YAAY,CAAC,KAArB;QACA,aAAa,OAAO,CAAC,OAAR,CAAgB;UAAC,KAAK,OAAO,CAAC,GAAR,CAAY,kBAAZ,CAAN;SAAhB,CADb;QAEA,EAAE,kBAAF,CAAqB,CAAC,KAAtB,EAFA;eAGA,EAAE,CAAC,MAAH,CAAU,EAAE,CAAC,cAAH,CAAkB,QAAQ,CAAC,YAA3B,EAAyC,UAAzC,CAAV,EAAgE,EAAE,kBAAF,CAAqB,CAAC,GAAtB,CAA0B,CAA1B,CAAhE,EAJF;OAJW;KAAb,EAb2B;GAtC7B;EA8DA,QAAQ,CAAC,YAAY,CAAC,QAAtB,GAAiC;WAE/B,EAAE,gBAAF,CAAmB,CAAC,GAApB,CAAwB,CAAxB,CAA0B,CAAC,SAA3B,GAAuC,EAAE,gBAAF,CAAmB,CAAC,GAApB,CAAwB,CAAxB,CAA0B,CAAC,aAFnC;GA9DjC;EAoEA,QAAQ,CAAC,QAAQ,CAAC,MAAlB,CAAyB;IAEvB,6BAA6B,SAAC,CAAD;AAC3B;aAAO,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,GAAnB,CAAuB,kBAAvB,CAAP;MACA,OAAO,IAAI,CAAC,OAAL,CAAa,MAAb,EAAoB,EAApB,CAAuB,CAAC,OAAxB,CAAgC,GAAhC,EAAoC,EAApC,CAAuC,CAAC,OAAxC,CAAgD,GAAhD,EAAqD,EAArD,CAAwD,CAAC,OAAzD,CAAiE,GAAjE,EAAsE,EAAtE,CADP;MAEA,OAAO,EAAE,OAAF,CAAU,CAAC,IAAX,CAAgB,KAAhB,EAAuB,IAAvB,CAA4B,CAAC,IAA7B,CAAkC,KAAlC,EAAyC,MAAzC,CAFP;MAGA,UAAU,IAAI,CAAC,IAAL,CAAU,SAAV,CAAoB,CAAC,MAArB,EAA6B,CAAC,IAA9B,EAHV;MAIA,WAAW,EAAE,cAAF,CAAiB,CAAC,IAAlB,CAAuB,UAAvB,CAJX;MAKA,SAAS,MAAM,CAAC,IAAP,EAAa,CAAC,GALvB;MAMA,SAAS,KANT;aAOA,YAAY,CAAC,WAAb,CAAyB,QAAzB,EAAmC,MAAnC,EAA2C,OAA3C,EAAoD,OAApD,EAA6D,MAA7D,EAR2B;KAFN;IAYvB,4BAA4B,SAAC,CAAD;AAE1B;QAAE,oBAAF,CAAuB,CAAC,WAAxB,CAAoC,SAApC;MACA,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,QAAnB,CAA4B,SAA5B,CADA;MAGA,WAAW,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,UAAxB,CAHX;MAIA,aAAa,OAAO,CAAC,OAAR,CAAgB;QAAC,KAAK,QAAN;OAAhB,CAJb;MAMA,OAAO,CAAC,GAAR,CAAY,kBAAZ,EAAgC,QAAhC,CANA;aAOA,MAAM,CAAC,IAAP,CAAY,iBAAZ,EAA+B,QAA/B,EAT0B;KAZL;IAwBvB,uBAAuB;aAIrB,QAAQ,CAAC,MAAT,CAAgB,cAAhB,EAAgC,wEAAhC,EAA0G,OAA1G,EAJqB;KAxBA;IA8BvB,yBAAyB;AAEvB,QAAE,WAAF,CAAc,CAAC,WAAf,CAA2B,UAA3B;aACA,EAAE,uBAAF,CAA0B,CAAC,WAA3B,CAAuC,UAAvC,EAHuB;KA9BF;IAmCvB,uBAAuB;AACrB,QAAE,cAAF,CAAiB,CAAC,WAAlB,CAA8B,QAA9B;aACA,QAAQ,CAAC,MAAT,CAAgB,YAAhB,EAA8B,qGAA9B,EAFqB;KAnCA;IAuCvB,qBAAqB;AACnB,QAAE,cAAF,CAAiB,CAAC,WAAlB,CAA8B,QAA9B;aACA,QAAQ,CAAC,MAAT,CAAgB,YAAhB,EAA8B,qGAA9B,EAFmB;KAvCE;IA2CvB,oBAAoB;AAElB,QAAE,WAAF,CAAc,CAAC,WAAf,CAA2B,UAA3B,CAAsC,CAAC,QAAvC,CAAgD,YAAhD;aACA,GAAG,CAAC,KAAK,CAAC,IAAV,CAAe,OAAf,EAHkB;KA3CG;IAgDvB,mBAAmB;aAEjB,EAAE,WAAF,CAAc,CAAC,WAAf,CAA2B,YAA3B,CAAwC,CAAC,QAAzC,CAAkD,WAAlD,EAFiB;KAhDI;IAoDvB,kBAAkB;aAEhB,EAAE,WAAF,CAAc,CAAC,WAAf,CAA2B,WAA3B,CAAuC,CAAC,QAAxC,CAAiD,UAAjD,EAFgB;KApDK;IAwDvB,8BAA8B,SAAC,CAAD;AAE5B;mBAAa,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,OAAnB,CAA2B,WAA3B,CAAb;aACA,UAAU,CAAC,WAAX,CAAuB,SAAvB,CAAiC,CAAC,QAAlC,CAA2C,UAA3C,EAH4B;KAxDP;IA6DvB,+BAA+B,SAAC,CAAD;AAE7B;mBAAa,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,OAAnB,CAA2B,WAA3B,CAAb;aACA,UAAU,CAAC,WAAX,CAAuB,UAAvB,CAAkC,CAAC,QAAnC,CAA4C,SAA5C,EAH6B;KA7DR;IAkEvB,yBAAyB,SAAC,CAAD;AAEvB;mBAAa,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,OAAnB,CAA2B,iBAA3B,CAAb;aACA,UAAU,CAAC,WAAX,CAAuB,SAAvB,CAAiC,CAAC,QAAlC,CAA2C,UAA3C,EAHuB;KAlEF;IAuEvB,0BAA0B,SAAC,CAAD;AAExB;mBAAa,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,OAAnB,CAA2B,iBAA3B,CAAb;aACA,UAAU,CAAC,WAAX,CAAuB,UAAvB,CAAkC,CAAC,QAAnC,CAA4C,SAA5C,EAHwB;KAvEH;IA4EvB,sBAAsB,SAAC,CAAD;AAEpB,UAAI,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,GAAnB,CAAuB,CAAvB,CAAyB,CAAC,YAA9B;MACA,YAAY,CAAC,IAAI,CAAC,cAAlB,GAAmC,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,GAAnB,CAAuB,CAAvB,CAAyB,CAAC,YAD7D;aAEA,YAAY,CAAC,IAAI,CAAC,kBAAlB,GAAuC,GAJnB;KA5EC;IAkFvB,yBAAyB,SAAC,CAAD;AAEvB,UAAG,CAAC,CAAC,KAAF,KAAW,EAAd;eACE,CAAC,CAAC,cAAF,GADF;OAFuB;KAlFF;IAuFvB,sBAAsB,SAAC,CAAD;AAEpB;cAAQ,CAAC,CAAC,KAAV;AAEA,UAAG,UAAS,CAAZ;AAEE,YAAI,WAAJ;QACA,MAAM,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,GAAnB,EADN;QAEA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,GAA9B,CAFA;QAGA,gBAAgB,IAAI,CAAC,KAAL,CAAW,EAAE,qBAAF,CAAwB,CAAC,GAAzB,CAA6B,CAA7B,CAA+B,CAAC,YAAhC,GAA+C,YAAY,CAAC,IAAI,CAAC,IAA5E,CAHhB;AAIA,YAAG,kBAAmB,YAAY,CAAC,IAAI,CAAC,WAArC,IAAqD,YAAY,CAAC,IAAI,CAAC,WAAlB,GAAgC,CAAxF;AAEE,cAAG,YAAY,CAAC,IAAI,CAAC,WAAlB,GAAgC,CAAnC;AACE,wBAAY,CAAC,IAAI,CAAC,cAAlB,GADF;;iBAEA,YAAY,CAAC,IAAI,CAAC,WAAlB,GAAgC,cAJlC;SANF;aAYK,IAAG,UAAS,EAAZ;AAEH,SAAC,CAAC,cAAF;QACA,WAAW,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,UAAxB,CADX;QAEA,SAAS,MAAM,CAAC,IAAP,EAAa,CAAC,GAFvB;QAGA,UAAU,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,GAAnB,EAHV;QAIA,SAAS,KAJT;eAKA,YAAY,CAAC,WAAb,CAAyB,QAAzB,EAAmC,MAAnC,EAA2C,OAA3C,EAAoD,MAApD,EAA4D,MAA5D,EAPG;;AAYH,iBAAS,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,GAAnB,CAAuB,CAAvB,CAAyB,CAAC,YAAnC;QACA,MAAM,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,GAAnB,EADN;QAEA,WAAW,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,UAAxB,CAFX;QAGA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,GAA9B,CAHA;AAIA,YAAG,YAAY,CAAC,IAAI,CAAC,cAAlB,KAAsC,MAAzC;AACE,cAAG,YAAY,CAAC,IAAI,CAAC,cAAlB,GAAmC,MAAtC;AACE,gBAAG,SAAS,GAAZ;AACE,kBAAI,aAAJ;cACA,YAAY,CAAC,IAAI,CAAC,cAAlB,CAAiC,MAAjC,CADA,CADF;aADF;;AAKE,gBAAI,YAAJ,EALF;WADF;SAJA;QAWA,QAAW;AACT;gBAAM,EAAN;UACA,OAAO,CAAC,OAAR,CAAgB;YAAC,OAAO,QAAR;WAAhB,CAAkC,CAAC,OAAO,CAAC,OAA3C,CAAmD,SAAC,CAAD;mBACjD,GAAG,CAAC,IAAJ,CAAS,CAAC,CAAC,EAAX,EADiD;WAAnD,CADA;iBAGA,IAJS;UAAH,EAXR;eAgBA,KAAK,CAAC,OAAN,CAAc,SAAC,EAAD;iBACZ,aAAa,CAAC,IAAd,CAAmB,EAAnB,EAAuB,QAAvB,EADY;SAAd,EA5BG;OAhBe;KAvFC;IAsIvB,2BAA2B;aAEzB,EAAE,cAAF,CAAiB,CAAC,QAAlB,CAA2B,QAA3B,EAFyB;KAtIJ;IA0IvB,yBAAyB;aAEvB,EAAE,YAAF,CAAe,CAAC,QAAhB,CAAyB,QAAzB,EAFuB;KA1IF;IA8IvB,0BAA0B;aAExB,EAAE,aAAF,CAAgB,CAAC,QAAjB,CAA0B,QAA1B,EAFwB;KA9IH;IAkJvB,2BAA2B;aAEzB,EAAE,cAAF,CAAiB,CAAC,WAAlB,CAA8B,QAA9B,EAFyB;KAlJJ;IAsJvB,yBAAyB;aAEvB,EAAE,YAAF,CAAe,CAAC,WAAhB,CAA4B,QAA5B,EAFuB;KAtJF;IA0JvB,0BAA0B;aAExB,EAAE,aAAF,CAAgB,CAAC,WAAjB,CAA6B,QAA7B,EAFwB;KA1JH;GAAzB,CApEA;EAoOA,IAAC,aAAD,GAAgB;IAEd,MAAM;MAEJ,gBAAgB,CAFZ;MAIJ,MAAM,EAJF;MAMJ,aAAa,CANT;MAQJ,gBAAgB,SAAC,MAAD;AAGd;UAAE,cAAF,CAAiB,CAAC,MAAlB,CAAyB,EAAE,cAAF,CAAiB,CAAC,MAAlB,KAA6B,IAAC,KAAvD;QACA,EAAE,gBAAF,CAAmB,CAAC,MAApB,CAA2B,EAAE,gBAAF,CAAmB,CAAC,MAApB,KAA+B,IAAC,KAA3D,CADA;QAEA,EAAE,cAAF,CAAiB,CAAC,MAAlB,CAAyB,EAAE,cAAF,CAAiB,CAAC,MAAlB,KAA6B,IAAC,KAAvD,CAFA;QAGA,IAAC,eAAD,GAAkB,EAAE,cAAF,CAAiB,CAAC,GAAlB,CAAsB,CAAtB,CAAwB,CAAC,YAH3C;QAIA,aAAa,SAAS,EAAE,cAAF,CAAiB,CAAC,GAAlB,CAAsB,QAAtB,CAAT,EAA0C,EAA1C,CAJb;QAKA,EAAE,cAAF,CAAiB,CAAC,GAAlB,CAAsB,QAAtB,EAAgC,aAAa,YAAY,CAAC,IAAI,CAAC,IAA/B,GAAsC,IAAtE,CALA;eAMA,IAAC,YAAD,GAAe,IAAI,CAAC,KAAL,CAAW,EAAE,qBAAF,CAAwB,CAAC,GAAzB,CAA6B,CAA7B,CAA+B,CAAC,YAAhC,GAA+C,IAAC,KAA3D,EATD;OARZ;MAmBJ,gBAAgB,SAAC,MAAD;AAEd;YAAI,YAAJ;QACA,EAAE,cAAF,CAAiB,CAAC,MAAlB,CAAyB,EAAE,cAAF,CAAiB,CAAC,MAAlB,KAA6B,IAAC,KAAvD,CADA;QAEA,EAAE,gBAAF,CAAmB,CAAC,MAApB,CAA2B,EAAE,gBAAF,CAAmB,CAAC,MAApB,KAA+B,IAAC,KAA3D,CAFA;QAGA,EAAE,cAAF,CAAiB,CAAC,MAAlB,CAAyB,EAAE,cAAF,CAAiB,CAAC,MAAlB,KAA6B,IAAC,KAAvD,CAHA;QAIA,aAAa,SAAS,EAAE,cAAF,CAAiB,CAAC,GAAlB,CAAsB,QAAtB,CAAT,EAA0C,EAA1C,CAJb;QAKA,EAAE,cAAF,CAAiB,CAAC,GAAlB,CAAsB,QAAtB,EAAgC,aAAa,YAAY,CAAC,IAAI,CAAC,IAA/B,GAAsC,IAAtE,CALA;QAMA,YAAY,CAAC,IAAI,CAAC,cAAlB,GAAmC,EAAE,cAAF,CAAiB,CAAC,GAAlB,CAAsB,CAAtB,CAAwB,CAAC,YAN5D;eAOA,IAAC,YAAD,GAAe,IAAI,CAAC,KAAL,CAAW,EAAE,qBAAF,CAAwB,CAAC,GAAzB,CAA6B,CAA7B,CAA+B,CAAC,YAAhC,GAA+C,IAAC,KAA3D,EATD;OAnBZ;MA8BJ,OAAO,aA9BH;KAFQ;IAsCd,aAAa,SAAC,QAAD,EAAW,MAAX,EAAmB,OAAnB,EAA4B,IAA5B,EAAkC,MAAlC;aAEX,MAAM,CAAC,IAAP,CAAY,aAAZ,EAA2B,QAA3B,EAAqC,MAArC,EAA6C,OAA7C,EAAsD,IAAtD,EAA4D,MAA5D,EAAoE,SAAC,GAAD,EAAM,GAAN;AAElE,YAAG,GAAH;iBAEE,QAAQ,CAAC,MAAT,CAAgB,SAAhB,EAA2B,2CAA3B,EAAwE,OAAxE,EAFF;;iBAMC,IAAI,gCAAJ,EAND;SAFkE;OAApE,EAFW;KAtCC;IAkDd,OAAO;MAEL,eAAe,SAAC,EAAD;AAEb;gBAAQ,EAAE,eAAF,CAAkB,CAAC,IAAnB,CAAwB,qBAAqB,EAArB,GAA0B,IAAlD,CAAR;AAEA,YAAG,KAAK,CAAC,MAAN,GAAe,CAAlB;AACE,cAAG,IAAC,QAAJ;AACE,yBAAa,IAAC,QAAd,EADF;;UAEA,KAAK,CAAC,QAAN,CAAe,UAAf,CAFA;iBAGA,IAAC,QAAD,GAAW,WAAW;mBACpB,KAAK,CAAC,WAAN,CAAkB,UAAlB,EADoB;WAAX,EAET,GAFS,EAJb;SAJa;OAFV;KAlDO;GApOhB,CAHF;;;AA6SA,IAAG,MAAM,CAAC,QAAV;AAEE,QAAM,CAAC,OAAP,CAAe;IAEb,eAAe,SAAC,QAAD,EAAW,MAAX,EAAmB,OAAnB,EAA4B,IAA5B,EAAkC,MAAlC;AAEb;gBAAU;QACR,QAAQ,MADA;QAER,MAAU,UAFF;QAGR,SAAS,OAHD;QAIR,MAAM,IAJE;QAKR,QAAQ,KALA;OAAV;MAQA,WAAW,OAAO,CAAC,OAAR,CAAgB;QAAC,OAAO,QAAR;OAAhB,CAAkC,CAAC,KAAnC,GAA2C,CARtD;aASA,OAAO,CAAC,MAAR,CAAe,QAAf,EAAyB;QAAC,OAAO;UAAC,YAAY,OAAb;SAAR;QAA+B,MAAM;UAAC,SAAS,QAAV;SAArC;OAAzB,EAXa;KAFF;IAgBb,aAAa,SAAC,QAAD,EAAW,MAAX,EAAmB,KAAnB;AAEX;gBAAU;QACR,QAAQ,MADA;QAER,MAAU,UAFF;QAGR,SAAS,KAHD;QAIR,MAAM,OAJE;QAKR,QAAQ,KALA;OAAV;MAQA,OAAO,CAAC,MAAR,CAAe,QAAf,EAAyB;QAAC,OAAO;UAAC,YAAY,OAAb;SAAR;OAAzB,CARA;MAUA,OAAO,CAAC,GAAR,CAAY,cAAZ,CAVA;aAWA,OAAO,CAAC,GAAR,CAAY,QAAZ,EAbW;KAhBA;IA+Bb,iBAAiB;aACf,OAAO,CAAC,GAAR,CAAY,QAAZ,EADe;KA/BJ;IAmCb,eAAe,SAAC,MAAD;AAEb;WAAS,OAAG,CAAC,EAAJ,EAAT;MAEA,IAAQ,YAFR;MAIA,SAAS;QACP,QAAQ,MADD;OAJT;MAQA,EAAE,CAAC,WAAH,CAAe,MAAf,EAAuB,SAAC,GAAD,EAAM,IAAN;AACrB,YAAI,GAAJ;AACE,iBAAO,CAAC,GAAR,CAAY,GAAZ,EAAiB,GAAG,CAAC,KAArB;iBACA,CAAC,CAAC,QAAD,CAAD,CAAS,KAAT,EAFF;;AAIE,iBAAO,CAAC,GAAR,CAAY,IAAZ;iBACA,CAAC,CAAC,QAAD,CAAD,CAAS,IAAT,EALF;SADqB;OAAvB,CARA;aAgBA,CAAC,CAAC,IAAF,GAlBa;KAnCF;IAuDb,yBAAyB,SAAC,MAAD,EAAS,GAAT,EAAc,UAAd,EAA0B,QAA1B,EAAoC,OAApC;AAEvB;oBAAc;QACZ,MAAM,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,IADlB;QAEZ,MAAM,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,IAFlB;QAGZ,SAAS,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,OAHrB;OAAd;MAKA,MAAM,CAAC,KAAK,CAAC,MAAb,CAAoB;QAAC,0CAA0C,GAAG,CAAC,GAA/C;OAApB,EAAyE;QAAC,MAAM;UAAC,2CAA2C,KAA5C;SAAP;OAAzE,EAAqI;QAAC,OAAO,IAAR;OAArI,CALA;MAMA,MAAM,CAAC,KAAK,CAAC,MAAb,CAAoB;QAAC,0CAA0C,GAAG,CAAC,GAA/C;OAApB,EAAyE;QAAC,MAAM;UAAC,+CAA+C,WAAhD;SAAP;OAAzE,EAA+I;QAAC,OAAO,IAAR;OAA/I,CANA;MAOA,MAAM,CAAC,KAAK,CAAC,IAAb,CAAkB;QAAC,0CAA0C,GAAG,CAAC,GAA/C;OAAlB,CAAsE,CAAC,KAAvE,EAA8E,CAAC,OAA/E,CAAuF,SAAC,IAAD;AACrF;aAAK,IAAI,CAAC,GAAV;QACA,WAAW,MAAM,CAAC,KAAK,CAAC,OAAb,CAAqB;UAAC,OAAO,EAAR;SAArB,CAAiC,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,KAAxD,GAAgE,CAD3E;QAEA,YAAY,MAAM,CAAC,KAAK,CAAC,OAAb,CAAqB;UAAC,OAAO,EAAR;SAArB,CAAiC,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,MAAxD,GAAiE,CAF7E;eAGA,MAAM,CAAC,KAAK,CAAC,MAAb,CAAoB;UAAC,OAAO,EAAR;SAApB,EAAiC;UAAC,MAAM;YAAC,+BAA+B,QAAhC;WAAP;UAAkD,MAAM;YAAC,qCAAqC,SAAtC;WAAxD;SAAjC,EAJqF;OAAvF,CAPA;MAYA,OAAO,CAAC,GAAR,CAAY,+BAAZ,CAZA;MAaA,OAAO,CAAC,GAAR,CAAY,MAAM,CAAC,KAAK,CAAC,IAAb,CAAkB;kDAA0C,GAAG,CAAC,GAA9C;OAAlB,CAAoE,CAAC,KAArE,EAAZ,CAbA;aAcA,OAAO,CAAC,GAAR,CAAY,GAAG,CAAC,GAAhB,EAhBuB;KAvDZ;IAyEb,mBAAmB,SAAC,EAAD;AAEjB;qBAAe,OAAO,CAAC,OAAR,CAAgB;QAAC,OAAO,EAAR;OAAhB,CAA4B,CAAC,WAA5C;MACA,cAAc,MAAM,CAAC,IADrB;MAEA,MAAM,CAAC,KAAK,CAAC,MAAb,CAAoB;QAAC,0CAA0C,EAA3C;OAApB,EAAoE;QAAC,MAAM;UAAC,2CAA2C,IAA5C;SAAP;OAApE,EAA+H;QAAC,OAAO,IAAR;OAA/H,CAFA;MAGA,MAAM,CAAC,KAAK,CAAC,MAAb,CAAoB;QAAC,0CAA0C,EAA3C;OAApB,EAAoE;QAAC,MAAM;UAAC,2CAA2C,IAA5C;SAAP;OAApE,EAA+H;QAAC,OAAO,IAAR;OAA/H,CAHA;aAKA,OAAO,CAAC,GAAR,CAAY,iCAAZ,EAPiB;KAzEN;GAAf,EAFF;CA7SA;A","sourcesContent":["if Meteor.isClient\n\n\n  Template.message.helpers {\n\n    getYours: (id)->\n      if id is Meteor.user()._id\n        'yours'\n      else\n        ''\n\n    showDate: (date)->\n      moment(date).lang('ru').calendar()\n  }\n\n  Template.messages.helpers {\n\n    showDate: (date)->\n      moment(date).lang('ru').calendar()\n\n    showMessage: (message, type)->\n\n      if type is 'text'\n        message\n      else if type is 'smile'\n        '<i class=\"fa fa-picture-o\" style=\"color: #ccc; margin-left: 7px;\"></i>'\n\n  }\n\n  Template.messagesCont.helpers {\n\n    getHeaderName: (members)->\n      string = ''\n      id = Meteor.user()._id\n      members.forEach (m)->\n        if id isnt m.id\n          string += m.firstName + ' ' + m.lastName + ', '\n      string.substring(0, string.length - 2)\n\n  }\n\n  Template.messages.rendered = ->\n\n    $firstThread = $('#threads-list').find('li').first()\n    $firstThread.addClass '_active'\n    Deps.autorun ->\n      user = Meteor.users.findOne({'profile.username': Session.get('currentUsersPage')})\n      if user\n        threadId = user.profile.com.messenger.threads[0].threadId\n        threadData = Threads.findOne({_id: threadId})\n        Session.set('messagesThreadId', Meteor.user().profile.com.messenger.threads[0].threadId)\n\n        UI.insert UI.renderWithData(Template.messagesCont, threadData), $('#messages-insert').get(0)\n\n    Deps.autorun ->\n\n      log 'Deps called for messages!'\n      targetThread = Threads.findOne({_id: Session.get('messagesThreadId')})\n      if targetThread\n        count = targetThread.total\n        threadData = Threads.findOne({_id: Session.get('messagesThreadId')})\n        $('#messages-insert').empty()\n        UI.insert UI.renderWithData(Template.messagesCont, threadData), $('#messages-insert').get(0)\n\n\n  Template.messagesCont.rendered = ->\n\n    $('#messages-cont').get(0).scrollTop = $('#messages-cont').get(0).scrollHeight\n\n\n\n  Template.messages.events {\n\n    'click .attach-cont .smile': (e)->\n      path = $(e.currentTarget).css('background-image')\n      path = path.replace('url(','').replace(')','').replace('\"', '').replace('\"', '')\n      $img = $('<img>').attr('src', path).attr('alt', 'meme')\n      message = $img.wrap(\"<div />\").parent().html()\n      threadId = $('#userMessage').data('threadid')\n      userId = Meteor.user()._id\n      attach = false\n      MessagesCtrl.sendMessage(threadId, userId, message, 'smile', attach)\n\n    'click #threads-list > li': (e)->\n\n      $('#threads-list > li').removeClass '_active'\n      $(e.currentTarget).addClass '_active'\n\n      threadId = $(e.currentTarget).data('threadid')\n      threadData = Threads.findOne({_id: threadId})\n\n      Session.set('messagesThreadId', threadId)\n      Meteor.call('setThreadStatus', threadId)\n\n\n    'click #record-audio': ->\n\n#      $('.recorder').addClass '_visible'\n#      $('.modal-overlay.higher').addClass '_visible'\n      MainCtrl.notify 'Прости бро:(', 'Мы еще не успели реализовать эту функцию:( Скоро все будет, обещаем!=)', 'error'\n\n    'click #close-recorder': ->\n\n      $('.recorder').removeClass '_visible'\n      $('.modal-overlay.higher').removeClass '_visible'\n\n    'click #attach-photo': ->\n      $('#choose-more').removeClass '_hover'\n      MainCtrl.notify 'Сорри бро(', 'Мы пока налаживаем серверы, по-этому функция временно недоступна:( Скоро все заработает, обещаем!))'\n\n    'click #make-photo': ->\n      $('#choose-more').removeClass '_hover'\n      MainCtrl.notify 'Сорри бро(', 'Мы пока налаживаем серверы, по-этому функция временно недоступна:( Скоро все заработает, обещаем!))'\n\n    'click #start-rec': ->\n\n      $('.recorder').removeClass('_initial').addClass('_recording')\n      ion.sound.play 'glass'\n\n    'click #stop-rec': ->\n\n      $('.recorder').removeClass('_recording').addClass('_recorded')\n\n    'click #rec-new': ->\n\n      $('.recorder').removeClass('_recorded').addClass('_initial')\n\n    'click .message.audio .play': (e)->\n\n      $targetDiv = $(e.currentTarget).closest('.controls')\n      $targetDiv.removeClass('_paused').addClass('_playing')\n\n    'click .message.audio .pause': (e)->\n\n      $targetDiv = $(e.currentTarget).closest('.controls')\n      $targetDiv.removeClass('_playing').addClass('_paused')\n\n    'click .recorder .play': (e)->\n\n      $targetDiv = $(e.currentTarget).closest('.lower-controls')\n      $targetDiv.removeClass('_paused').addClass('_playing')\n\n    'click .recorder .pause': (e)->\n\n      $targetDiv = $(e.currentTarget).closest('.lower-controls')\n      $targetDiv.removeClass('_playing').addClass('_paused')\n\n    'focus #userMessage': (e)->\n\n      log $(e.currentTarget).get(0).scrollHeight\n      MessagesCtrl.view.textareaHeight = $(e.currentTarget).get(0).scrollHeight\n      MessagesCtrl.view.textareaHeightStep = 18\n\n    'keypress #userMessage': (e)->\n\n      if e.which is 13\n        e.preventDefault()\n\n    'keyup #userMessage': (e)->\n\n      keyID = e.which\n\n      if keyID is 8\n\n        log 'backspace'\n        val = $(e.currentTarget).val()\n        $('#messageHeightMeter').html(val)\n        newLineNumber = Math.floor $('#messageHeightMeter').get(0).scrollHeight / MessagesCtrl.view.step\n        if newLineNumber isnt MessagesCtrl.view.linesNumber and MessagesCtrl.view.linesNumber > 1\n\n          if MessagesCtrl.view.linesNumber < 5\n            MessagesCtrl.view.decreaseHeight()\n          MessagesCtrl.view.linesNumber = newLineNumber\n\n      else if keyID is 13\n\n        e.preventDefault()\n        threadId = $(e.currentTarget).data('threadid')\n        userId = Meteor.user()._id\n        message = $(e.currentTarget).val()\n        attach = false\n        MessagesCtrl.sendMessage(threadId, userId, message, 'text', attach)\n\n\n      else\n\n        height = $(e.currentTarget).get(0).scrollHeight\n        val = $(e.currentTarget).val()\n        threadId = $(e.currentTarget).data('threadid')\n        $('#messageHeightMeter').html(val)\n        if MessagesCtrl.view.textareaHeight isnt height\n          if MessagesCtrl.view.textareaHeight < height\n            if height < 100\n              log 'invalidated'\n              MessagesCtrl.view.increaseHeight(height)\n          else\n            log 'increasing'\n        users = do ->\n          arr = []\n          Threads.findOne({'_id': threadId}).members.forEach (m)->\n            arr.push m.id\n          arr\n        users.forEach (id)->\n          ThreadsStream.emit id, threadId\n\n    'mouseenter .smile-hover': ->\n\n      $('.smile-hover').addClass '_hover'\n\n    'mouseenter .gif-hover': ->\n\n      $('.gif-hover').addClass '_hover'\n\n    'mouseenter .more-hover': ->\n\n      $('.more-hover').addClass '_hover'\n\n    'mouseleave .smile-hover': ->\n\n      $('.smile-hover').removeClass '_hover'\n\n    'mouseleave .gif-hover': ->\n\n      $('.gif-hover').removeClass '_hover'\n\n    'mouseleave .more-hover': ->\n\n      $('.more-hover').removeClass '_hover'\n\n  }\n\n  @MessagesCtrl = {\n\n    view: {\n\n      textareaHeight: 0\n\n      step: 18\n\n      linesNumber: 1\n\n      increaseHeight: (height)->\n\n\n        $('#userMessage').height($('#userMessage').height() + @step)\n        $('#messages-cont').height($('#messages-cont').height() - @step)\n        $('#new-message').height($('#new-message').height() + @step)\n        @textareaHeight = $('#userMessage').get(0).scrollHeight\n        gradBottom = parseInt $('.grad.bottom').css('bottom'), 10\n        $('.grad.bottom').css('bottom', gradBottom + MessagesCtrl.view.step + 'px')\n        @linesNumber = Math.floor $('#messageHeightMeter').get(0).scrollHeight / @step\n\n      decreaseHeight: (height)->\n\n        log 'decreasing'\n        $('#userMessage').height($('#userMessage').height() - @step)\n        $('#messages-cont').height($('#messages-cont').height() + @step)\n        $('#new-message').height($('#new-message').height() - @step)\n        gradBottom = parseInt $('.grad.bottom').css('bottom'), 10\n        $('.grad.bottom').css('bottom', gradBottom - MessagesCtrl.view.step + 'px')\n        MessagesCtrl.view.textareaHeight = $('#userMessage').get(0).scrollHeight\n        @linesNumber = Math.floor $('#messageHeightMeter').get(0).scrollHeight / @step\n\n      clear: ->\n        #\n\n\n    }\n\n    sendMessage: (threadId, userId, message, type, attach)->\n\n      Meteor.call 'sendMessage', threadId, userId, message, type, attach, (err, res)->\n\n        if err\n\n          MainCtrl.notify 'Упсики(', 'Сообщение не передано, попробуйте еще раз', 'error'\n\n        else\n\n         log 'Все ок! Сообщение отправлено!!'\n\n    utils: {\n\n      notifyWriting: (id)->\n\n        $elem = $('#threads-list').find('[data-threadId=\"' + id + '\"]')\n\n        if $elem.length > 0\n          if @timeout\n            clearTimeout @timeout\n          $elem.addClass '_writing'\n          @timeout = setTimeout ->\n            $elem.removeClass '_writing'\n          , 500\n\n    }\n\n\n  }\n\n\nif Meteor.isServer\n\n  Meteor.methods {\n\n    'sendMessage': (threadId, userId, message, type, attach)->\n\n      message = {\n        userId: userId,\n        date: new Date()\n        message: message\n        type: type\n        attach: false\n      }\n\n      setTotal = Threads.findOne({'_id': threadId}).total + 1\n      Threads.update threadId, {$push: {'messages': message}, $set: {'total': setTotal}} #Messenger in users coll gets updated with hooks. Watch collections/threads.coffee\n\n\n    'sendAudio': (threadId, userId, audio)->\n\n      message = {\n        userId: userId,\n        date: new Date()\n        message: audio\n        type: 'audio'\n        attach: false\n      }\n\n      Threads.update threadId, {$push: {'messages': message}}\n\n      console.log 'message Sent'\n      console.log threadId\n\n    'deleteMessage': ->\n      console.log 'delete'\n\n\n    'listObjects': (bucket)->\n\n      s3 = new AWS.S3()\n\n      f = new Future()\n\n      params = {\n        Bucket: bucket,\n      }\n\n      s3.listObjects params, (err, data)->\n        if (err)\n          console.log(err, err.stack)\n          f.return(false)\n        else\n          console.log(data)\n          f.return(data)\n\n      f.wait()\n\n    'updateUsersThreadsRec': (userId, doc, fieldNames, modifier, options)->\n\n      lastMessage = {\n        date: modifier.$push.messages.date\n        type: modifier.$push.messages.type\n        message: modifier.$push.messages.message\n      }\n      Meteor.users.update {'profile.com.messenger.threads.threadId': doc._id}, {$set: {'profile.com.messenger.threads.$.allRead': false}}, {multi: true}\n      Meteor.users.update {'profile.com.messenger.threads.threadId': doc._id}, {$set: {'profile.com.messenger.threads.$.lastMessage': lastMessage}}, {multi: true}\n      Meteor.users.find({'profile.com.messenger.threads.threadId': doc._id}).fetch().forEach (user)->\n        id = user._id\n        newCount = Meteor.users.findOne({'_id': id}).profile.com.messenger.count + 1\n        newUnread = Meteor.users.findOne({'_id': id}).profile.com.messenger.unread + 1\n        Meteor.users.update {'_id': id}, {$set: {'profile.com.messenger.count': newCount}, $set: {'profile.com.messenger.unreadCount': newUnread}}\n      console.log 'Members.com.messenger updated'\n      console.log Meteor.users.find('profile.com.messenger.threads.threadId': doc._id).fetch()\n      console.log doc._id\n\n    'setThreadStatus': (id)->\n\n      threadUnread = Threads.findOne({'_id': id}).unreadCount\n      totalUnread = Meteor.user\n      Meteor.users.update {'profile.com.messenger.threads.threadId': id}, {$set: {'profile.com.messenger.threads.$.allRead': true}}, {multi: true}\n      Meteor.users.update {'profile.com.messenger.threads.threadId': id}, {$set: {'profile.com.messenger.threads.$.allRead': true}}, {multi: true}\n\n      console.log 'Thread status updated to true!!'\n\n\n  }\n"]}